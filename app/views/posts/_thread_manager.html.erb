<div class="bg-surface0 rounded-lg shadow" 
     data-controller="thread-manager" 
     data-thread-manager-max-posts-value="10"
     data-thread-manager-active-index-value="0">
  
  <div class="flex items-center justify-between p-4 border-b border-subtle">
    <h2 class="text-lg font-medium text-primary">Create Thread</h2>
    <button type="button" 
            class="text-tertiary hover:text-primary"
            data-action="click->thread-manager#exitThread">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>
  
  <!-- Thread post navigation -->
  <div class="flex border-b border-subtle p-2 overflow-x-auto">
    <% thread_posts.each_with_index do |post, index| %>
      <button type="button" 
              class="thread-nav-button min-w-[40px] h-8 rounded-full mx-1 text-sm <%= index == 0 ? 'bg-surface1 text-primary' : 'bg-surface0 text-secondary hover:bg-surface1' %>"
              data-index="<%= index %>"
              data-action="click->thread-manager#switchPost">
        <%= index + 1 %>
      </button>
    <% end %>
    
    <button type="button"
            class="flex items-center justify-center w-8 h-8 rounded-full bg-surface1 text-primary mx-1 hover:bg-surface2"
            data-action="click->thread-manager#addPost">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
      </svg>
    </button>
  </div>
  
  <!-- Thread post container -->
  <div class="p-4" data-thread-manager-target="container">
    <% thread_posts.each_with_index do |post, index| %>
      <div class="thread-post <%= index == 0 ? '' : 'hidden' %>" 
           data-thread-manager-target="post" 
           id="thread-post-<%= index %>">
        
        <div class="flex justify-between items-center mb-2">
          <div class="text-sm text-secondary">
            Post <span class="post-number"><%= index + 1 %>/<%= thread_posts.size %></span>
          </div>
          
          <button type="button" 
                  class="p-1 text-tertiary hover:text-primary <%= thread_posts.size <= 1 && index == 0 ? 'invisible' : '' %>"
                  data-index="<%= index %>"
                  data-action="click->thread-manager#removePost">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
            </svg>
          </button>
        </div>
        
        <textarea class="w-full h-32 rounded-md bg-surface1 border-subtle text-primary resize-y focus:ring-accent focus:border-accent p-3"
                  name="thread_posts[<%= index %>][content]"
                  placeholder="What's on your mind?"><%= post[:content] %></textarea>
      </div>
    <% end %>
  </div>
  
  <!-- Template for new thread posts (hidden) -->
  <div class="hidden" data-thread-manager-target="template">
    <div class="thread-post">
      <div class="flex justify-between items-center mb-2">
        <div class="text-sm text-secondary">
          Post <span class="post-number"></span>
        </div>
        
        <button type="button" 
                class="p-1 text-tertiary hover:text-primary"
                data-action="click->thread-manager#removePost">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
          </svg>
        </button>
      </div>
      
      <textarea class="w-full h-32 rounded-md bg-surface1 border-subtle text-primary resize-y focus:ring-accent focus:border-accent p-3"
                placeholder="What's on your mind?"></textarea>
    </div>
  </div>
  
  <input type="hidden" name="active_thread_index" value="0" data-thread-manager-target="activeIndex">
  
  <!-- Thread actions -->
  <div class="flex justify-between p-4 border-t border-subtle">
    <button type="button" 
            class="bg-surface1 hover:bg-surface2 text-primary py-2 px-4 rounded-lg"
            data-action="click->thread-manager#exitThread">
      Cancel
    </button>
    
    <button type="submit" 
            class="bg-accent hover:bg-accent-hover text-white py-2 px-4 rounded-lg"
            form="post-form">
      Post Thread
    </button>
  </div>
</div>